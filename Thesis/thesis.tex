% LaTeX mintafájl szakdolgozat és diplomamunkáknak az
% SZTE Informatikai Tanszekcsoportja által megkövetelt
% formai követelményeinek megvalósításához
% Modositva: 2011.04.28 Nemeth L. Zoltan
% A fájl használatához szükséges a magyar.ldf 2005/05/12 v1.5-ös vagy késõbbi verziója
% ez letölthetõ a http://www.math.bme.hu/latex/ weblapról, a magyar nyelvû szedéshez
% Hasznos információk, linekek, LaTeX leirasok a www.latex.lap.hu weboldalon vannak.
%


\documentclass[12pt]{report}

%Magyar nyelvi támogatás (Babel 3.7 vagy késõbbi kell!)
\def\magyarOptions{defaults=hu-min}
\usepackage[magyar]{babel}

%Az ékezetes betûk használatához:
\usepackage{t1enc}% ékezetes szavak automatikus elválasztásához
\usepackage[latin2]{inputenc}% ékezetes szavak beviteléhez

% A formai kovetelmenyekben megkövetelt Times betûtípus hasznalata:
\usepackage{times}

%Az AMS csomagjai
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{subfig}
\usepackage{url}

% Minted package and its dependencies
\usepackage[outputdir=Output]{minted}
\usemintedstyle{manni}
\usepackage{fancyvrb}
\usepackage{float}
\usepackage{ifplatform}
\usepackage{etoolbox}
\usepackage{xstring}
\usepackage{lineno}
\usepackage{tabu}

%A fejléc láblécek kialakításához:
\usepackage{fancyhdr}

%Természetesen további csomagok is használhatók,
%például ábrák beillesztéséhez a graphix és a psfrag,
%ha nincs rájuk szükség természetesen kihagyhatók.
\usepackage{graphicx}
\usepackage{psfrag}
\usepackage{wrapfig}
\usepackage[table]{xcolor}
\usepackage{colortbl}
\definecolor{DebuggerBlue}{HTML}{CBC8FD}
\definecolor{GameBoyBlue}{HTML}{D6DFE4}
\definecolor{GameBoyDarkBlue}{HTML}{27307F}
\definecolor{GameBoyRed}{HTML}{F91D24}
\definecolor{LightGray}{HTML}{F0F0F0}
\definecolor{GBLLG}{HTML}{9BBC0F}
\definecolor{GBLG}{HTML}{8BAC0F}
\definecolor{GBDG}{HTML}{306230}
\definecolor{GBDDG}{HTML}{0F380F}
%Tételszerû környezetek definiálhatók, ezek most fejezetenkent egyutt szamozodnak, pl.

%Ha a megjegyzések és a példak szövegét nem akarjuk dõlten szedni, akkor
%az alábbi parancs után kell õket definiální:


%Margók:
\hoffset -1in
\voffset -1in
\oddsidemargin 35mm
\textwidth 150mm
\topmargin 15mm
\headheight 10mm
\headsep 5mm
\textheight 237mm

\begin{document}

%A FEJEZETEK KEZDÕOLDALAINAK FEJ ES LÁBLÉCE:
%a plain oldalstílust kell átdefiniálni, hogy ott ne legyen fejléc:
\fancypagestyle{plain}{%
%ez mindent töröl:
\fancyhf{}
% a láblécbe jobboldalra kerüljön az oldalszám:
\fancyfoot[R]{\thepage}
%elválasztó vonal sem kell:
\renewcommand{\headrulewidth}{0pt}
}

%A TÖBBI OLDAL FEJ ÉS LÁBLÉCE:
\pagestyle{fancy}
\fancyhf{}
\lhead{Nintendo Game Boy Zilog Z80 emulátor implementálása}
\rfoot{\thepage}


%A címoldalra se fej- se lábléc nem kell:
\thispagestyle{empty}

\begin{center}
\vspace*{1cm}
{\Large\bf Szegedi Tudományegyetem}

\vspace{0.5cm}

{\Large\bf Informatikai Intézet}

\vspace*{3.8cm}


{\LARGE\bf Nintendo Game Boy Zilog Z80 emulátor \\
\vspace{0.3cm} implementálása}


\vspace*{3.3cm}

{\Large Diplomamunka}
% vagy {\Large Szakdolgozat}

\vspace*{4cm}

%Értelemszerûen megváltoztatandó:
{\large
\begin{tabular}{c@{\hspace{4cm}}c}
\emph{Készítette:}     &\emph{Témavezetõ:}\\
\bf{Krizsák Tibor}  &\bf{Dr. Tanács Attila}\\
programtervezõ informatikus MSc  &egyetemi adjunktus\\
szakos hallgató&
\end{tabular}
}

\vspace*{2.3cm}

{\Large
Szeged
\\
\vspace{2mm}
2018
}
\end{center}


%A tartalomjegyzék:
\tableofcontents

%A \chapter* parancs nem ad a fejezetnek sorszámot
\chapter*{Feladatkiírás}
%A tartalomjegyzékben mégis szerepeltetni kell, mint szakasz(section) szerepeljen:
\addcontentsline{toc}{section}{Feladatkiírás}

\noindent A Nintendo Game Boy egy 1989-ban bemutatott, 8 bites kézi videojáték-konzol. A kon\-zol\-ban egy Zilog Z80 (az Intel 8080 utódja) processzor mûködik, kiegészítve néhány specifikus utasítással. A Game Boy emulátor fejlesztésének bemutatása során a CPU utasításait, a GPU renderelésének mûködését, a memóriakezelést, és a megszakítás-ve\-zér\-lést kell implementálni. Ahhoz, hogy ezek megfelelõen mûködjenek, a CPU frek\-ven\-ci\-á\-já\-ra, illetve a képfrissítési gyorsaságra is tekintettel kell lenni. \\

\noindent A játékkonzol emulátorok fejlesztése során a szûk, ezzel foglalkozó fejlesztõi réteg ki\-a\-la\-kí\-tott egy egyértelmû, jól követhetõ fejlesztési folyamatot. A dolgozatban ezen keresztül kerüljenek bemutatásra a Nintendo Game Boy emulátor fejlesztési fázisai. \\

\noindent A tesztelés a más Zilog Z80 emulátor fejlesztõk által készített teszt ROM-okon történjen.

\chapter*{Tartalmi összefoglaló}
\addcontentsline{toc}{section}{Tartalmi összefoglaló}

\begin{itemize}
  \item \textbf{A téma megnevezése:} \\
  Egy emulátor fejlesztési fázisainak bemutatása a Nintendo Game Boy hardveren keresztül, Rust nyelven implementálva.

  \item \textbf{A megadott feladat megfogalmazása:} \\
  A feladat egy Nintendo Game Boy emulátor implementálása, és fejlesztési fá\-zi\-sa\-i\-nak bemutatása. A bemutatás során a CPU utasításait, a GPU renderelésének mûködését, a memóriakezelést, és a megszakítás-vezérlést kell érinteni, illetve az egyéb kisebb, de a mûködéshez elengedhetetlen megoldások is megemlítésre kerül\-nek. Ahhoz, hogy ezek megfelelõen mûködjenek, a CPU frekvenciájára, illetve a képfrissítési gyorsaságra is tekintettel kell lenni.

  \item \textbf{A megoldási mód:} \\
  Az emulátor fejlesztõ közösség által összegyûjtött, -- \textit{reverse-engineered} -- in\-for\-má\-ci\-ók\-ra, illetve a processzor gyártója által kiadott technikai dokumentációra ha\-gyat\-koz\-va felépítettem és implementáltam a CPU struktúráját, utasításkészletét, majd a többi modult, részegységet. Meghatároztam a modulok közti kommunikációt, idõzítéseket, adatfolyamot. A videojáték-, illetve teszt ROM-ok byte-jait sorra be\-ol\-vas\-va az emulátor meghatározza a megfelelõ mûveletet, meghatározott i\-dõ\-kö\-zön\-ként renderel, illetve kezeli a meg\-szakításokat.

  \item \textbf{Alkalmazott eszközök, módszerek:} \\
  Az emulátor Linux rendszeren, Rust nyelven került implementálásra, a \texttt{rustc} fordító, illetve a \texttt{cargo} package manager segítségével. A rendereléshez a \texttt{minifb} libraryt használtam, ami egy nagyon egyszerû framebuffer használatát teszi lehetõvé. A fejlesztésre került egy debugger eszköz, illetve egy memóriatérkép eszköz is, ami nagyban megkönnyítette a hibakeresést.

  \item \textbf{Elért eredmények:} \\
  Az implementált emulátor képes futtatni Memory Banking nélküli videojáték ROM-okat, az inputra az elvárásoknak megfelelõen reagálva. A processzor mûveletek és a renderelés az eredeti konzollal megegyezõ eredményt adnak. A közösségi Game Boy teszt ROM-ok szinte mindegyikét sikerrel végrehajtja.

  \item \textbf{Kulcsszavak:} \\
  Nintendo, Game Boy, emulátor, fejlesztés, Rust

\end{itemize}




\chapter*{Bevezetés}
\addcontentsline{toc}{section}{Bevezetés}

A számítástechnikában az emuláció fogalma nem új keletû. Különbözõ területeken, kü\-lön\-féle problémák megoldására használnak emulátorokat, ugyancsak különbözõ okokból. A nyom\-ta\-tók\-tól kezdve, a DOS-kártyákon keresztül, a többmagos rendszertervezésen át egészen a videojáték konzolokig terjed a paletta - nem túlzás azt állítani, hogy az emulátorok ott vannak a mindennapjainkban. \\
Ezen diplomamunka a videojáték konzolok emulátorainak fejlesztésére fókuszál. Többféle cél állhat a háttérben, ha valaki ilyen emulátor fejlesztésére adja a fejét: a régi hõskorbeli konzolok digitális megõrzése vagy életre keltése, késõbbi szoftverfejlesztés az emulált hardveren, esetleg hobbiként. Az utóbbi évek tendenciája azt mutatja, hogy ez utóbbi ok egyre gyakoribb - az emulátor fejlesztõi közösség napról napra nagyobb és aktívabb, szokások és kisebb fejlesztõi folklór alakult ki az emulátor készítését illetõen - a dolgozat ennek bemutatására helyezi a hangsúlyt. \\
Az emulátor fejlesztés szemléltetése Nintendo Game Boy kézi videojáték konzolon ke\-resz\-tül fog történni, amely a maga idejében egy igazán sikeres konzol volt, és tulajdonkép\-pen kultusz épült köré. A 8 bites architektúrájából adódóan kevéssé bonyolult felépítéssel rendelkezik, népszerûségébõl adódóan jól dokumentált, így az emulálásának imp\-le\-men\-tá\-ci\-ójához nincs szükség túl sok \textit{reverse-engineering} gyakorlatra. \\
A dolgozat elsõ néhány fejezetében az emulátorokról, a Nintendo Game Boy hardverérõl, specifikációjáról, illetve a késõbbi fejlesztés workflow-járól fog szó esni. Ezekben a fe\-je\-ze\-tekben van megfogalmazva, illetve leírva az, hogy pontosan mi az az emulátor, milyen hardver emulációjáról van szó, és hogy az emuláció teljes implementálásáig milyen pon\-to\-kon keresztül vezet az út. A következõ nagyobb logikai egység az implementáció. Ennek részeként elõször bemutatásra kerülnek az alkalmazott eszközök, technológiák, majd az emulátor pontos és elvárt specifikációjának leírását az igazi implementációs szakasz követi. \\
A processzor modellezése a regiszterek, flagek, és egyéb jellemzõk megtervezésével kez\-dõ\-dik, majd következõ lépésként az utasításkészlet megvalósításával folytatódik. A CPU-hoz szorosan kapcsolódó memória ez után kerül tárgyalásra. A memória ismertetése után az idõzítõk, majd a PPU felépítése és mûködése szerepel. Az implementáció ezen pontján a Boot ROM már futtathatóvá válik, errõl is esik majd néhány szó. A fej\-lesz\-té\-si részt a joypad jellemzõi és megoldásai zárják. \\
A dolgozat zárásaként bemutatásra kerül az emulátor használata, illetve a fejlesztésbõl adódó dependenciák, majd végül a teszt ROM-ok jellemzõi, futtatásuk, és a futtatási e\-red\-mé\-nyeik.

\input{./1st_chapter.tex} % Az emulátorok és a Nindendo Game Boy
\input{./2nd_chapter.tex} % Az emulátor fejlesztési folyamata
\input{./3rd_chapter.tex} % A processzor és a memória implementációja
\input{./4th_chapter.tex} % A kijelzõ és a PPU implementációja
\input{./5th_chapter.tex} % Joypad
\input{./6th_chapter.tex} % A program használata, tesztelés, és az elért eredmények
\input{./appendix.tex}    % Függelék
\chapter*{Nyilatkozat}
%Egy üres sort adunk a tartalomjegyzékhez:
\addtocontents{toc}{\ }
\addcontentsline{toc}{section}{Nyilatkozat}
%\hspace{\parindent}

% A nyilatkozat szövege más titkos és nem titkos dolgozatok esetében.
% Csak az egyik tipusú myilatokzatnak kell a dolgozatban szerepelni
% A ponok helyére az adatok értelemszerûen behelyettesídendõk es
% a szakdolgozat /diplomamunka szo megfeleloen kivalasztando.


%A nyilatkozat szövege TITKOSNAK NEM MINÕSÍTETT dolgozatban a következõ:
%A pontokkal jelölt szövegrészek értelemszerûen a szövegszerkesztõben és
%nem kézzel helyettesítendõk:

\noindent
Alulírott \makebox[4cm]{\dotfill} szakos hallgató, kijelentem, hogy a dolgozatomat a Sze\-ge\-di Tudományegyetem, Informatikai Intézet \makebox[4cm]{\dotfill} Tanszékén készí\-tet\-tem, \makebox[4cm]{\dotfill} diploma megszerzése érdekében.

Kijelentem, hogy a dolgozatot más szakon korábban nem védtem meg, saját munkám eredménye, és csak a hivatkozott forrásokat (szakirodalom, eszközök, stb.) használtam fel.

Tudomásul veszem, hogy diplomamunkámat a Szegedi Tu\-do\-mány\-e\-gye\-tem In\-for\-ma\-ti\-ka\-i Intézet könyvtárában, a helyben olvasható könyvek között helyezik el.

\vspace*{2cm}

\begin{tabular}{lc}
Szeged, \today\
\hspace{2cm} & \makebox[6cm]{\dotfill} \\
& aláírás \\
\end{tabular}


\vspace*{4cm}

\chapter*{Köszönetnyilvánítás}
\addcontentsline{toc}{section}{Köszönetnyilvánítás}



% A folyoszovegben \cite{bibitemazonosito}-val lehet hivatkozni
%% Az irodalomjegyzek keszitheto a BibTeX segedprogrammal:
%\bibliography{diploma}
%\bibliographystyle{plain}

%VAGY "kézzel" a következõ módon:

\begin{thebibliography}{9}
%10-nél kevesebb hivatkozás esetén

%\begin{thebibliography}{99}
% 10-nél több hivatkozás esetén

\addcontentsline{toc}{section}{Irodalomjegyzék}

%Elso szerzok vezetekneve alapjan ábécérendben rendezve.

\bibitem{Tanenbaum}
Andrew S. Tanenbaum,
\emph{Számítógép-architektúrák},
Panem Könyvkiadó Kft., Budapest, 2006.

\bibitem{WikiGB}
Wikipedia,
\emph{Game Boy},
\url{https://hu.wikipedia.org/wiki/Game_Boy}.

\end{thebibliography}

\end{document}